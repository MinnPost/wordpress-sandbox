"use strict";

(function ($) {
  function showPassword() {
    // Cache our jquery elements
    var $submit = $('.btn-submit');
    var $field = $('.password-show');
    var show_pass = '<div class="a-form-show-password a-form-caption"><label><input type="checkbox" name="show_password" id="show-password-checkbox" value="1"> Show password</label></div>'; // Inject the toggle button into the page

    $field.after(show_pass); // Cache the toggle button

    var $toggle = $('#show-password-checkbox'); // Toggle the field type

    $toggle.on('click', function (e) {
      var checkbox = $(this);

      if (checkbox.is(':checked')) {
        $field.attr('type', 'text');
      } else {
        $field.attr('type', 'password');
      }
    }); // Set the form field back to a regular password element

    $submit.on('click', function (e) {
      $field.attr('type', 'password');
    });
  }

  function checkPasswordStrength($password, $strengthMeter, $strengthText, $submitButton, disallowListArray) {
    var password = $password.val(); // Reset the form & meter
    //$submitButton.attr( 'disabled', 'disabled' );

    $strengthText.removeClass('short bad good strong'); // Extend our disallowList array with those from the inputs & site data

    disallowListArray = disallowListArray.concat(wp.passwordStrength.userInputDisallowedList()); // Get the password strength

    var strength = wp.passwordStrength.meter(password, disallowListArray, password); // Add the strength meter results

    switch (strength) {
      case 2:
        $strengthText.addClass('bad').html('Strength: <strong>' + pwsL10n.bad + '</strong>');
        break;

      case 3:
        $strengthText.addClass('good').html('Strength: <strong>' + pwsL10n.good + '</strong>');
        break;

      case 4:
        $strengthText.addClass('strong').html('Strength: <strong>' + pwsL10n.strong + '</strong>');
        break;

      case 5:
        $strengthText.addClass('short').html('Strength: <strong>' + pwsL10n.mismatch + '</strong>');
        break;

      default:
        $strengthText.addClass('short').html('Strength: <strong>' + pwsL10n.short + '</strong>');
    }

    $strengthMeter.val(strength); // Only enable the submit button if the password is strong

    /*
    if ( 4 === strength ) {
        $submitButton.removeAttr( 'disabled' );
    }*/

    return strength;
  }

  function checkZipCountry(city_field, state_field, zip_field, country_field) {
    var country = country_field.val();

    if (country == '') {
      country = 'US';
      country_field.val(country);
    }

    var zip = zip_field.val();

    if (zip !== '') {
      var location = {
        zip_code: zip,
        country: country
      };
      jQuery.ajax({
        type: 'GET',
        url: user_account_management_rest.site_url + user_account_management_rest.rest_namespace + '/check-zip',
        data: location,
        dataType: 'json',
        success: function success(response) {
          if (response.status === 'success') {
            var location = '';
            location += response.city;
            $(city_field).val(response.city);

            if (response.city !== response.state) {
              location += ', ' + response.state;
              $(state_field).val(response.state);
            }

            if (country !== 'US') {
              location += ', ' + country;
            }

            $('.location small').text(location);
          } else {
            $('.location small').text('');
          }
        }
      });
    }
  }

  $(document).ready(function () {
    // start
    if ($('#rh-name').length > 0) {
      $('#rh-name').val('');
    } // show password if user clicks


    if ($('.password-show').length > 0) {
      showPassword();
    } // checkPasswordStrength


    if ($('.password-strength-check').length > 0) {
      var $before = $('.a-form-show-password');
      $before.after($('<meter max="4" id="password-strength"><div></div></meter><p id="password-strength-text"></p>'));
      $('body').on('keyup', 'input[name=password], input[name=new_password]', function (event) {
        checkPasswordStrength($('input[name=password], input[name=new_password]'), // Password field
        $('#password-strength'), // Strength meter
        $('#password-strength-text'), // Strength text indicator
        $('input[type=submit]'), // Submit button
        ['disallowed', 'listed', 'word'] // disallowed words
        );
      });
    } // zip/country thing


    var country = $('.m-form-country #country').val();

    if ($('.m-form-zip-code #zip-code').length) {
      if (country == '' || country == 'US') {
        $('.m-form-country').hide();
        $('.m-form-zip-code #zip-code').prop('type', 'tel');
        $('.m-form-zip-code').append('<div class="a-form-caption location"><small></small></div><div class="a-form-caption show-country"><a href="#" id="registration_show_country"><small>Not in the US?</small></a></div>');
      } else if ($('.m-form-country #country').length > 0) {
        $('.m-form-zip-code label').html('Postal Code: <span title="This field is required." class="a-form-item-required">*</span>');
        $('.m-form-zip-code #zip-code').prop('type', 'text');
      }

      if ($('.m-form-country #country').length > 0) {
        if ($('select, input', '.m-form-country').hasClass('not-in-us')) {
          $('.show-country', '.m-form-zip-code').remove();
          $('.m-form-country').show();
          $('.m-form-zip-code #zip-code').prop('type', 'text');
          $('.m-form-zip-code label').html('Postal Code: <span title="This field is required." class="a-form-item-required">*</span>');
        }

        if ($('.m-form-city #city').length == 0 && $('.m-form-state #state').length == 0) {
          $('.m-form-country #country, .m-form-zip-code #zip-code').blur(function () {
            checkZipCountry($('input[name="city"]'), $('input[name="state"]'), $('.m-form-zip-code #zip-code'), $('.m-form-country #country'));
          });
          $('.m-form-country #country').change(function () {
            checkZipCountry($('input[name="city"]'), $('input[name="state"]'), $('.m-form-zip-code #zip-code'), $('.m-form-country #country'));
          });
        }

        $('#registration_show_country').click(function () {
          $('.m-form-zip-code label').html('Postal Code: <span title="This field is required." class="a-form-item-required">*</span>');
          $('.m-form-country').slideDown();
          $('.m-form-zip-code #zip-code').prop('type', 'text');
          $(this).hide();
          return false;
        });
      }
    }
  });
})(jQuery);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInVzZXIuanMiXSwibmFtZXMiOlsiJCIsInNob3dQYXNzd29yZCIsIiRzdWJtaXQiLCIkZmllbGQiLCJzaG93X3Bhc3MiLCJhZnRlciIsIiR0b2dnbGUiLCJvbiIsImUiLCJjaGVja2JveCIsImlzIiwiYXR0ciIsImNoZWNrUGFzc3dvcmRTdHJlbmd0aCIsIiRwYXNzd29yZCIsIiRzdHJlbmd0aE1ldGVyIiwiJHN0cmVuZ3RoVGV4dCIsIiRzdWJtaXRCdXR0b24iLCJkaXNhbGxvd0xpc3RBcnJheSIsInBhc3N3b3JkIiwidmFsIiwicmVtb3ZlQ2xhc3MiLCJjb25jYXQiLCJ3cCIsInBhc3N3b3JkU3RyZW5ndGgiLCJ1c2VySW5wdXREaXNhbGxvd2VkTGlzdCIsInN0cmVuZ3RoIiwibWV0ZXIiLCJhZGRDbGFzcyIsImh0bWwiLCJwd3NMMTBuIiwiYmFkIiwiZ29vZCIsInN0cm9uZyIsIm1pc21hdGNoIiwic2hvcnQiLCJjaGVja1ppcENvdW50cnkiLCJjaXR5X2ZpZWxkIiwic3RhdGVfZmllbGQiLCJ6aXBfZmllbGQiLCJjb3VudHJ5X2ZpZWxkIiwiY291bnRyeSIsInppcCIsImxvY2F0aW9uIiwiemlwX2NvZGUiLCJqUXVlcnkiLCJhamF4IiwidHlwZSIsInVybCIsInVzZXJfYWNjb3VudF9tYW5hZ2VtZW50X3Jlc3QiLCJzaXRlX3VybCIsInJlc3RfbmFtZXNwYWNlIiwiZGF0YSIsImRhdGFUeXBlIiwic3VjY2VzcyIsInJlc3BvbnNlIiwic3RhdHVzIiwiY2l0eSIsInN0YXRlIiwidGV4dCIsImRvY3VtZW50IiwicmVhZHkiLCJsZW5ndGgiLCIkYmVmb3JlIiwiZXZlbnQiLCJoaWRlIiwicHJvcCIsImFwcGVuZCIsImhhc0NsYXNzIiwicmVtb3ZlIiwic2hvdyIsImJsdXIiLCJjaGFuZ2UiLCJjbGljayIsInNsaWRlRG93biJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxDQUFDLFVBQVNBLENBQVQsRUFBVztBQUVYLFdBQVNDLFlBQVQsR0FBd0I7QUFDdkI7QUFD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WUFBVztBQUNoRHhFLFVBQUFBLENBQUMsQ0FBQyx3QkFBRCxDQUFELENBQTRCNEIsSUFBNUIsQ0FBaUMsMEZBQWpDO0FBQ0E1QixVQUFBQSxDQUFDLENBQUMsaUJBQUQsQ0FBRCxDQUFxQnlFLFNBQXJCO0FBQ0F6RSxVQUFBQSxDQUFDLENBQUMsNEJBQUQsQ0FBRCxDQUFnQ2lFLElBQWhDLENBQXFDLE1BQXJDLEVBQTZDLE1BQTdDO0FBQ0FqRSxVQUFBQSxDQUFDLENBQUMsSUFBRCxDQUFELENBQVFnRSxJQUFSO0FBQ0EsaUJBQU8sS0FBUDtBQUNBLFNBTkQ7QUFPQTtBQUNEO0FBRUQsR0FoRUQ7QUFrRUEsQ0EvS0QsRUErS0dwQixNQS9LSCIsImZpbGUiOiJ1c2VyLWFjY291bnQtbWFuYWdlbWVudC5qcyIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbigkKXtcblxuXHRmdW5jdGlvbiBzaG93UGFzc3dvcmQoKSB7XG5cdFx0Ly8gQ2FjaGUgb3VyIGpxdWVyeSBlbGVtZW50c1xuXHRcdHZhciAkc3VibWl0ID0gJCgnLmJ0bi1zdWJtaXQnKTtcblx0XHR2YXIgJGZpZWxkID0gJCgnLnBhc3N3b3JkLXNob3cnKTtcblx0XHR2YXIgc2hvd19wYXNzID0gJzxkaXYgY2xhc3M9XCJhLWZvcm0tc2hvdy1wYXNzd29yZCBhLWZvcm0tY2FwdGlvblwiPjxsYWJlbD48aW5wdXQgdHlwZT1cImNoZWNrYm94XCIgbmFtZT1cInNob3dfcGFzc3dvcmRcIiBpZD1cInNob3ctcGFzc3dvcmQtY2hlY2tib3hcIiB2YWx1ZT1cIjFcIj4gU2hvdyBwYXNzd29yZDwvbGFiZWw+PC9kaXY+Jztcblx0XHQvLyBJbmplY3QgdGhlIHRvZ2dsZSBidXR0b24gaW50byB0aGUgcGFnZVxuXHRcdCRmaWVsZC5hZnRlciggc2hvd19wYXNzICk7XG5cdFx0Ly8gQ2FjaGUgdGhlIHRvZ2dsZSBidXR0b25cblx0XHR2YXIgJHRvZ2dsZSA9ICQoJyNzaG93LXBhc3N3b3JkLWNoZWNrYm94Jyk7XG5cdFx0Ly8gVG9nZ2xlIHRoZSBmaWVsZCB0eXBlXG5cdFx0JHRvZ2dsZS5vbignY2xpY2snLCBmdW5jdGlvbihlKSB7XG5cdFx0XHR2YXIgY2hlY2tib3ggPSAkKHRoaXMpO1xuXHRcdFx0aWYgKGNoZWNrYm94LmlzKCc6Y2hlY2tlZCcpKSB7XG5cdFx0XHRcdCRmaWVsZC5hdHRyKCd0eXBlJywgJ3RleHQnKTtcblx0XHRcdH0gZWxzZSB7XG5cdFx0XHRcdCRmaWVsZC5hdHRyKCd0eXBlJywgJ3Bhc3N3b3JkJyk7XG5cdFx0XHR9XG5cdFx0fSk7XG5cdFx0Ly8gU2V0IHRoZSBmb3JtIGZpZWxkIGJhY2sgdG8gYSByZWd1bGFyIHBhc3N3b3JkIGVsZW1lbnRcblx0XHQkc3VibWl0Lm9uKCAnY2xpY2snLCBmdW5jdGlvbihlKSB7XG5cdFx0XHQkZmllbGQuYXR0cigndHlwZScsICdwYXNzd29yZCcpO1xuXHRcdH0pO1xuXHR9XG5cblx0ZnVuY3Rpb24gY2hlY2tQYXNzd29yZFN0cmVuZ3RoKCAkcGFzc3dvcmQsICRzdHJlbmd0aE1ldGVyLCAkc3RyZW5ndGhUZXh0LCAkc3VibWl0QnV0dG9uLCBkaXNhbGxvd0xpc3RBcnJheSApIHtcblx0ICAgIHZhciBwYXNzd29yZCA9ICRwYXNzd29yZC52YWwoKTtcblxuXHQgICAgLy8gUmVzZXQgdGhlIGZvcm0gJiBtZXRlclxuXHQgICAgLy8kc3VibWl0QnV0dG9uLmF0dHIoICdkaXNhYmxlZCcsICdkaXNhYmxlZCcgKTtcblx0ICAgICRzdHJlbmd0aFRleHQucmVtb3ZlQ2xhc3MoICdzaG9ydCBiYWQgZ29vZCBzdHJvbmcnICk7XG5cblx0ICAgIC8vIEV4dGVuZCBvdXIgZGlzYWxsb3dMaXN0IGFycmF5IHdpdGggdGhvc2UgZnJvbSB0aGUgaW5wdXRzICYgc2l0ZSBkYXRhXG5cdCAgICBkaXNhbGxvd0xpc3RBcnJheSA9IGRpc2FsbG93TGlzdEFycmF5LmNvbmNhdCggd3AucGFzc3dvcmRTdHJlbmd0aC51c2VySW5wdXREaXNhbGxvd2VkTGlzdCgpIClcblxuXHQgICAgLy8gR2V0IHRoZSBwYXNzd29yZCBzdHJlbmd0aFxuXHQgICAgdmFyIHN0cmVuZ3RoID0gd3AucGFzc3dvcmRTdHJlbmd0aC5tZXRlciggcGFzc3dvcmQsIGRpc2FsbG93TGlzdEFycmF5LCBwYXNzd29yZCApO1xuXG5cdCAgICAvLyBBZGQgdGhlIHN0cmVuZ3RoIG1ldGVyIHJlc3VsdHNcblx0ICAgIHN3aXRjaCAoIHN0cmVuZ3RoICkge1xuXHQgICAgICAgIGNhc2UgMjpcblx0ICAgICAgICAgICAgJHN0cmVuZ3RoVGV4dC5hZGRDbGFzcyggJ2JhZCcgKS5odG1sKCAnU3RyZW5ndGg6IDxzdHJvbmc+JyArIHB3c0wxMG4uYmFkICsgJzwvc3Ryb25nPicgKTtcblx0ICAgICAgICAgICAgYnJlYWs7XG5cdCAgICAgICAgY2FzZSAzOlxuXHQgICAgICAgICAgICAkc3RyZW5ndGhUZXh0LmFkZENsYXNzKCAnZ29vZCcgKS5odG1sKCAnU3RyZW5ndGg6IDxzdHJvbmc+JyArIHB3c0wxMG4uZ29vZCArICc8L3N0cm9uZz4nICk7XG5cdCAgICAgICAgICAgIGJyZWFrO1xuXHQgICAgICAgIGNhc2UgNDpcblx0ICAgICAgICAgICAgJHN0cmVuZ3RoVGV4dC5hZGRDbGFzcyggJ3N0cm9uZycgKS5odG1sKCAnU3RyZW5ndGg6IDxzdHJvbmc+JyArIHB3c0wxMG4uc3Ryb25nICsgJzwvc3Ryb25nPicgKTtcblx0ICAgICAgICAgICAgYnJlYWs7XG5cdCAgICAgICAgY2FzZSA1OlxuXHQgICAgICAgICAgICAkc3RyZW5ndGhUZXh0LmFkZENsYXNzKCAnc2hvcnQnICkuaHRtbCggJ1N0cmVuZ3RoOiA8c3Ryb25nPicgKyBwd3NMMTBuLm1pc21hdGNoICsgJzwvc3Ryb25nPicgKTtcblx0ICAgICAgICAgICAgYnJlYWs7XG5cdCAgICAgICAgZGVmYXVsdDpcblx0ICAgICAgICAgICAgJHN0cmVuZ3RoVGV4dC5hZGRDbGFzcyggJ3Nob3J0JyApLmh0bWwoICdTdHJlbmd0aDogPHN0cm9uZz4nICsgcHdzTDEwbi5zaG9ydCArICc8L3N0cm9uZz4nICk7XG5cdCAgICB9XG5cdCAgICAkc3RyZW5ndGhNZXRlci52YWwoc3RyZW5ndGgpO1xuXG5cdCAgICAvLyBPbmx5IGVuYWJsZSB0aGUgc3VibWl0IGJ1dHRvbiBpZiB0aGUgcGFzc3dvcmQgaXMgc3Ryb25nXG5cdCAgICAvKlxuXHQgICAgaWYgKCA0ID09PSBzdHJlbmd0aCApIHtcblx0ICAgICAgICAkc3VibWl0QnV0dG9uLnJlbW92ZUF0dHIoICdkaXNhYmxlZCcgKTtcblx0ICAgIH0qL1xuXG5cdCAgICByZXR1cm4gc3RyZW5ndGg7XG5cdH1cblxuXHRmdW5jdGlvbiBjaGVja1ppcENvdW50cnkoY2l0eV9maWVsZCwgc3RhdGVfZmllbGQsIHppcF9maWVsZCwgY291bnRyeV9maWVsZCkge1xuXG5cdFx0dmFyIGNvdW50cnkgPSBjb3VudHJ5X2ZpZWxkLnZhbCgpO1xuXHRcdGlmIChjb3VudHJ5ID09ICcnKSB7XG5cdFx0XHRjb3VudHJ5ID0gJ1VTJztcblx0XHRcdGNvdW50cnlfZmllbGQudmFsKGNvdW50cnkpO1xuXHRcdH1cblx0XHR2YXIgemlwID0gemlwX2ZpZWxkLnZhbCgpO1xuXG5cdFx0aWYgKHppcCAhPT0gJycpIHtcblxuXHRcdFx0dmFyIGxvY2F0aW9uID0ge1xuXHRcdFx0XHR6aXBfY29kZTogemlwLFxuXHRcdFx0XHRjb3VudHJ5OiBjb3VudHJ5XG5cdFx0XHR9XG5cblx0XHRcdGpRdWVyeS5hamF4KHtcblx0XHQgICAgICAgIHR5cGU6ICdHRVQnLFxuXHRcdCAgICAgICAgdXJsOiB1c2VyX2FjY291bnRfbWFuYWdlbWVudF9yZXN0LnNpdGVfdXJsICsgdXNlcl9hY2NvdW50X21hbmFnZW1lbnRfcmVzdC5yZXN0X25hbWVzcGFjZSArICcvY2hlY2stemlwJyxcblx0XHQgICAgICAgIGRhdGE6IGxvY2F0aW9uLFxuXHRcdCAgICAgICAgZGF0YVR5cGU6ICdqc29uJyxcblx0XHQgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG5cdFx0ICAgICAgICBcdGlmIChyZXNwb25zZS5zdGF0dXMgPT09ICdzdWNjZXNzJykge1xuXHRcdFx0XHRcdFx0dmFyIGxvY2F0aW9uID0gJyc7XG5cdFx0XHRcdFx0XHRsb2NhdGlvbiArPSByZXNwb25zZS5jaXR5O1xuXHRcdFx0XHRcdFx0JChjaXR5X2ZpZWxkKS52YWwocmVzcG9uc2UuY2l0eSk7XG5cdFx0XHRcdFx0XHRpZiAocmVzcG9uc2UuY2l0eSAhPT0gcmVzcG9uc2Uuc3RhdGUpIHtcblx0XHRcdFx0XHRcdFx0bG9jYXRpb24gKz0gJywgJyArIHJlc3BvbnNlLnN0YXRlO1xuXHRcdFx0XHRcdFx0XHQkKHN0YXRlX2ZpZWxkKS52YWwocmVzcG9uc2Uuc3RhdGUpO1xuXHRcdFx0XHRcdFx0fVxuXHRcdFx0XHRcdFx0aWYgKGNvdW50cnkgIT09ICdVUycpIHtcblx0XHRcdFx0XHRcdFx0bG9jYXRpb24gKz0gJywgJyArIGNvdW50cnk7XG5cdFx0XHRcdFx0XHR9XG5cdFx0XHRcdFx0XHQkKCcubG9jYXRpb24gc21hbGwnKS50ZXh0KGxvY2F0aW9uKTtcblx0XHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdFx0JCgnLmxvY2F0aW9uIHNtYWxsJykudGV4dCgnJyk7XG5cdFx0XHRcdFx0fVxuXHRcdCAgICAgICAgfVxuXHRcdCAgICB9KTtcblx0XHR9XG5cdH1cblxuXHQkKGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbigpIHtcblxuXHRcdC8vIHN0YXJ0XG5cdFx0aWYgKCQoJyNyaC1uYW1lJykubGVuZ3RoID4gMCApIHtcblx0XHRcdCQoICcjcmgtbmFtZScgKS52YWwoICcnICk7XG5cdFx0fVxuXG5cdFx0Ly8gc2hvdyBwYXNzd29yZCBpZiB1c2VyIGNsaWNrc1xuXHRcdGlmICgkKCcucGFzc3dvcmQtc2hvdycpLmxlbmd0aCA+IDAgKSB7XG5cdFx0XHRzaG93UGFzc3dvcmQoKTtcblx0XHR9XG5cdFx0Ly8gY2hlY2tQYXNzd29yZFN0cmVuZ3RoXG5cdFx0aWYgKCQoJy5wYXNzd29yZC1zdHJlbmd0aC1jaGVjaycpLmxlbmd0aCA+IDAgKSB7XG5cdFx0XHR2YXIgJGJlZm9yZSA9ICQoJy5hLWZvcm0tc2hvdy1wYXNzd29yZCcpO1xuXHRcdFx0JGJlZm9yZS5hZnRlciggJCgnPG1ldGVyIG1heD1cIjRcIiBpZD1cInBhc3N3b3JkLXN0cmVuZ3RoXCI+PGRpdj48L2Rpdj48L21ldGVyPjxwIGlkPVwicGFzc3dvcmQtc3RyZW5ndGgtdGV4dFwiPjwvcD4nKSk7XG5cdFx0ICAgICQoICdib2R5JyApLm9uKCAna2V5dXAnLCAnaW5wdXRbbmFtZT1wYXNzd29yZF0sIGlucHV0W25hbWU9bmV3X3Bhc3N3b3JkXScsXG5cdFx0ICAgICAgICBmdW5jdGlvbiggZXZlbnQgKSB7XG5cdFx0ICAgICAgICAgICAgY2hlY2tQYXNzd29yZFN0cmVuZ3RoKFxuXHRcdCAgICAgICAgICAgICAgICAkKCdpbnB1dFtuYW1lPXBhc3N3b3JkXSwgaW5wdXRbbmFtZT1uZXdfcGFzc3dvcmRdJyksIC8vIFBhc3N3b3JkIGZpZWxkXG5cdFx0ICAgICAgICAgICAgICAgICQoJyNwYXNzd29yZC1zdHJlbmd0aCcpLCAgICAgICAgICAgLy8gU3RyZW5ndGggbWV0ZXJcblx0XHQgICAgICAgICAgICAgICAgJCgnI3Bhc3N3b3JkLXN0cmVuZ3RoLXRleHQnKSwgICAgICAvLyBTdHJlbmd0aCB0ZXh0IGluZGljYXRvclxuXHRcdCAgICAgICAgICAgICAgICAkKCdpbnB1dFt0eXBlPXN1Ym1pdF0nKSwgICAgICAgICAgIC8vIFN1Ym1pdCBidXR0b25cblx0XHQgICAgICAgICAgICAgICAgWydkaXNhbGxvd2VkJywgJ2xpc3RlZCcsICd3b3JkJ10gICAgICAgIC8vIGRpc2FsbG93ZWQgd29yZHNcblx0XHQgICAgICAgICAgICApO1xuXHRcdCAgICAgICAgfVxuXHRcdCAgICApO1xuXHRcdH1cblxuXHRcdC8vIHppcC9jb3VudHJ5IHRoaW5nXG5cdFx0dmFyIGNvdW50cnkgPSAkKCcubS1mb3JtLWNvdW50cnkgI2NvdW50cnknKS52YWwoKTtcblx0XHRpZiAoJCgnLm0tZm9ybS16aXAtY29kZSAjemlwLWNvZGUnKS5sZW5ndGgpIHtcblx0XHRcdGlmIChjb3VudHJ5ID09ICcnIHx8IGNvdW50cnkgPT0gJ1VTJykge1xuXHRcdFx0XHQkKCcubS1mb3JtLWNvdW50cnknKS5oaWRlKCk7XG5cdFx0XHRcdCQoJy5tLWZvcm0temlwLWNvZGUgI3ppcC1jb2RlJykucHJvcCgndHlwZScsICd0ZWwnKTtcblx0XHRcdFx0JCgnLm0tZm9ybS16aXAtY29kZScpLmFwcGVuZCgnPGRpdiBjbGFzcz1cImEtZm9ybS1jYXB0aW9uIGxvY2F0aW9uXCI+PHNtYWxsPjwvc21hbGw+PC9kaXY+PGRpdiBjbGFzcz1cImEtZm9ybS1jYXB0aW9uIHNob3ctY291bnRyeVwiPjxhIGhyZWY9XCIjXCIgaWQ9XCJyZWdpc3RyYXRpb25fc2hvd19jb3VudHJ5XCI+PHNtYWxsPk5vdCBpbiB0aGUgVVM/PC9zbWFsbD48L2E+PC9kaXY+Jyk7XG5cdFx0XHR9IGVsc2UgaWYgKCQoJy5tLWZvcm0tY291bnRyeSAjY291bnRyeScpLmxlbmd0aCA+IDApIHtcblx0XHRcdFx0JCgnLm0tZm9ybS16aXAtY29kZSBsYWJlbCcpLmh0bWwoJ1Bvc3RhbCBDb2RlOiA8c3BhbiB0aXRsZT1cIlRoaXMgZmllbGQgaXMgcmVxdWlyZWQuXCIgY2xhc3M9XCJhLWZvcm0taXRlbS1yZXF1aXJlZFwiPio8L3NwYW4+Jyk7XG5cdFx0XHRcdCQoJy5tLWZvcm0temlwLWNvZGUgI3ppcC1jb2RlJykucHJvcCgndHlwZScsICd0ZXh0Jyk7XG5cdFx0XHR9XG5cdFx0XHRpZiAoJCgnLm0tZm9ybS1jb3VudHJ5ICNjb3VudHJ5JykubGVuZ3RoID4gMCkge1xuXHRcdFx0XHRpZiAoJCgnc2VsZWN0LCBpbnB1dCcsICcubS1mb3JtLWNvdW50cnknKS5oYXNDbGFzcygnbm90LWluLXVzJykpIHtcblx0XHRcdFx0XHQkKCcuc2hvdy1jb3VudHJ5JywgJy5tLWZvcm0temlwLWNvZGUnKS5yZW1vdmUoKTtcblx0XHRcdFx0XHQkKCcubS1mb3JtLWNvdW50cnknKS5zaG93KCk7XG5cdFx0XHRcdFx0JCgnLm0tZm9ybS16aXAtY29kZSAjemlwLWNvZGUnKS5wcm9wKCd0eXBlJywgJ3RleHQnKTtcblx0XHRcdFx0XHQkKCcubS1mb3JtLXppcC1jb2RlIGxhYmVsJykuaHRtbCgnUG9zdGFsIENvZGU6IDxzcGFuIHRpdGxlPVwiVGhpcyBmaWVsZCBpcyByZXF1aXJlZC5cIiBjbGFzcz1cImEtZm9ybS1pdGVtLXJlcXVpcmVkXCI+Kjwvc3Bhbj4nKTtcblx0XHRcdFx0fVxuXHRcdFx0XHRpZiAoJCgnLm0tZm9ybS1jaXR5ICNjaXR5JykubGVuZ3RoID09IDAgJiYgJCgnLm0tZm9ybS1zdGF0ZSAjc3RhdGUnKS5sZW5ndGggPT0gMCkge1xuXHRcdFx0XHRcdCQoJy5tLWZvcm0tY291bnRyeSAjY291bnRyeSwgLm0tZm9ybS16aXAtY29kZSAjemlwLWNvZGUnKS5ibHVyKGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdFx0Y2hlY2taaXBDb3VudHJ5KCQoJ2lucHV0W25hbWU9XCJjaXR5XCJdJyksICQoJ2lucHV0W25hbWU9XCJzdGF0ZVwiXScpLCAkKCcubS1mb3JtLXppcC1jb2RlICN6aXAtY29kZScpLCAkKCcubS1mb3JtLWNvdW50cnkgI2NvdW50cnknKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdFx0JCgnLm0tZm9ybS1jb3VudHJ5ICNjb3VudHJ5JykuY2hhbmdlKGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdFx0Y2hlY2taaXBDb3VudHJ5KCQoJ2lucHV0W25hbWU9XCJjaXR5XCJdJyksICQoJ2lucHV0W25hbWU9XCJzdGF0ZVwiXScpLCAkKCcubS1mb3JtLXppcC1jb2RlICN6aXAtY29kZScpLCAkKCcubS1mb3JtLWNvdW50cnkgI2NvdW50cnknKSk7XG5cdFx0XHRcdFx0fSk7XG5cdFx0XHRcdH1cblx0XHRcdFx0JCgnI3JlZ2lzdHJhdGlvbl9zaG93X2NvdW50cnknKS5jbGljayhmdW5jdGlvbigpIHtcblx0XHRcdFx0XHQkKCcubS1mb3JtLXppcC1jb2RlIGxhYmVsJykuaHRtbCgnUG9zdGFsIENvZGU6IDxzcGFuIHRpdGxlPVwiVGhpcyBmaWVsZCBpcyByZXF1aXJlZC5cIiBjbGFzcz1cImEtZm9ybS1pdGVtLXJlcXVpcmVkXCI+Kjwvc3Bhbj4nKTtcblx0XHRcdFx0XHQkKCcubS1mb3JtLWNvdW50cnknKS5zbGlkZURvd24oKTtcblx0XHRcdFx0XHQkKCcubS1mb3JtLXppcC1jb2RlICN6aXAtY29kZScpLnByb3AoJ3R5cGUnLCAndGV4dCcpO1xuXHRcdFx0XHRcdCQodGhpcykuaGlkZSgpO1xuXHRcdFx0XHRcdHJldHVybiBmYWxzZTtcblx0XHRcdFx0fSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdH0pO1xuXG59KShqUXVlcnkpO1xuIl19
